# KDG-Forensic-Tool
A Forensic tool to parse,extract and recreate timeline of a disk image of a EXT4 File System
## üéØ Overview

This system consists of three integrated components:

1. **Extractor.py** - Extracts filesystem metadata and timestamps from disk images
2. **Analyser.py** - Analyzes timeline data and detects suspicious patterns
3. **Main.py** - Orchestrates the complete workflow

## üöÄ Quick Start

### Installation

```bash
# Install required dependencies
pip install -r requirements.txt

# Verify installation
python -c "import pytsk3, pandas; print('‚úì Dependencies installed')"
```

### Basic Usage

```bash
# Run complete analysis (extract + analyze)
python Main.py

# Or run components separately:
python Extractor.py  # Creates timeline.csv
python Analyser.py   # Creates forensic_report.html
```

## üì¶ Components

### 1. Extractor.py - Timeline Extraction

**Purpose:** Extracts filesystem metadata from disk images and creates a comprehensive timeline.

**Features:**
- Supports various disk image formats (raw, E01, AFF, etc.)
- Extracts four timestamp types: CRTIME, MTIME, ATIME, CTIME
- Handles partitioned and unpartitioned images
- Identifies deleted files
- Configurable scan limits for large images

**Output:** `timeline.csv` with columns:
- `time` - Timestamp in UTC ISO format
- `type` - Timestamp type (CRTIME/MTIME/ATIME/CTIME)
- `path` - File path
- `partition` - Partition description
- `inode` - Inode number
- `size` - File size in bytes
- `deleted` - Boolean (True if file is deleted)

**Configuration:**
```python
SCAN_LIMIT = 10000  # Max files to scan (prevent memory issues)
OUTPUT_CSV = "timeline.csv"  # Output filename
```

### 2. Analyser.py - Suspicious Activity Detection

**Purpose:** Analyzes timeline data and detects forensically significant patterns.

**Detection Rules:**

1. **Access Before Creation**
   - Detects: ATIME < CRTIME
   - Indicates: Timestamp manipulation

2. **Modified Before Creation**
   - Detects: MTIME < CRTIME
   - Indicates: Timestamp stomping

3. **Rapid Timestamp Activity**
   - Detects: All timestamps within 2 seconds
   - Indicates: Automated/scripted file operations

4. **Deleted File Accessed**
   - Detects: Deleted files with access timestamps
   - Indicates: Potential anti-forensic activity

**Output:** `forensic_report.html` with:
- Summary statistics
- Suspicious files table
- Full file timeline
- Raw timeline events

**Configuration:**
```python
CSV_FILE = "timeline.csv"  # Input from Extractor
OUTPUT_HTML = "forensic_report.html"  # Report output
```

### 3. Main.py - Workflow Orchestrator

**Purpose:** Runs the complete analysis pipeline automatically.

**Workflow:**
```
User Input (Disk Image)
    ‚Üì
Extractor.py (Extract Timeline)
    ‚Üì
timeline.csv
    ‚Üì
Analyser.py (Detect Suspicious)
    ‚Üì
forensic_report.html
```

## üìä Usage Examples

### Example 1: Analyze a Raw Disk Image

```bash
python Main.py
# Enter: /path/to/evidence.dd
# Output: forensic_report.html
```

### Example 2: Re-analyze Existing Timeline

```bash
# If you already have timeline.csv
python Analyser.py
# Output: forensic_report.html
```

### Example 3: Extract Only (No Analysis)

```bash
python Extractor.py
# Enter: /path/to/image.E01
# Output: timeline.csv
```

## üîç Detection Examples

### Suspicious Pattern 1: Timestamp Stomping

```
File: malware.exe
CRTIME: 2024-01-20 15:00:00
ATIME:  2024-01-20 14:30:00  ‚Üê Earlier!
Flag: "Access before creation"
```

**Forensic Interpretation:**
- File cannot be accessed before it exists
- Likely timestamp manipulation to hide malware installation

### Suspicious Pattern 2: Rapid Activity

```
File: dropper.tmp
CRTIME: 2024-01-20 10:00:00
MTIME:  2024-01-20 10:00:01
ATIME:  2024-01-20 10:00:01
CTIME:  2024-01-20 10:00:01
Flag: "Rapid timestamp activity (<2s)"
```

**Forensic Interpretation:**
- All operations within 1 second
- Indicates automated malware dropper
- Typical of create‚Üíexecute‚Üídelete pattern

### Suspicious Pattern 3: Deleted File Access

```
File: credentials.txt
Deleted: True
ATIME: 2024-01-20 16:30:00  ‚Üê Recent access
Flag: "Deleted file accessed"
```

**Forensic Interpretation:**
- File was accessed after deletion
- Possible data exfiltration
- Anti-forensic file wiping

## üìÅ File Structure

```
forensic-timeline-system/
‚îÇ
‚îú‚îÄ‚îÄ Main.py              # Workflow orchestrator
‚îú‚îÄ‚îÄ Extractor.py         # Timeline extraction engine
‚îú‚îÄ‚îÄ Analyser.py          # Suspicious activity detector
‚îÇ
‚îú‚îÄ‚îÄ requirements.txt     # Python dependencies
‚îú‚îÄ‚îÄ README.md           # This file
‚îú‚îÄ‚îÄ DOCUMENTATION.md    # Detailed technical documentation
‚îÇ
‚îú‚îÄ‚îÄ timeline.csv        # Generated by Extractor.py
‚îî‚îÄ‚îÄ forensic_report.html # Generated by Analyser.py
```

## üîß Technical Details

### Supported Disk Image Formats

- **Raw Images:** .dd, .raw, .img
- **Expert Witness Format:** .E01, .Ex01
- **Advanced Forensic Format:** .aff, .afd
- **Virtual Disk Images:** .vmdk, .vdi (raw access)

### Supported Filesystems

Via pytsk3 (The Sleuth Kit):
- **NTFS** - Windows primary filesystem
- **FAT12/16/32** - Legacy Windows, USB drives
- **exFAT** - Modern external storage
- **EXT2/3/4** - Linux filesystems
- **HFS+** - macOS filesystem
- **ISO9660** - CD/DVD filesystems
- **UFS** - Unix File System

### Timestamp Types Explained

| Type | Name | Description |
|------|------|-------------|
| **CRTIME** | Creation Time | When file was created (birth time) |
| **MTIME** | Modification Time | When file content was last modified |
| **ATIME** | Access Time | When file was last accessed/read |
| **CTIME** | Change Time | When file metadata was changed |

## ‚ö†Ô∏è Important Notes

### Scan Limits

The default `SCAN_LIMIT = 10000` prevents memory exhaustion on large images:

```python
# For small images (<10GB):
SCAN_LIMIT = 50000

# For large images (>100GB):
SCAN_LIMIT = 10000  # Use default

# For forensic workstations (32GB+ RAM):
SCAN_LIMIT = 100000
```

### Performance Considerations

| Image Size | Scan Limit | Approx. Time | Memory Usage |
|------------|------------|--------------|--------------|
| 1 GB | 10,000 | ~2 min | ~500 MB |
| 10 GB | 10,000 | ~5 min | ~500 MB |
| 100 GB | 10,000 | ~10 min | ~500 MB |
| 500 GB | 10,000 | ~20 min | ~500 MB |

**Note:** Time varies based on file count, not disk size.

### Deleted File Detection

Deleted files are identified via inode flags:
```python
deleted = bool(meta.flags & pytsk3.TSK_FS_META_FLAG_UNALLOC)
```

This works for:
- ‚úÖ Recently deleted files (inode still allocated)
- ‚úÖ Files in unallocated space
- ‚ùå Overwritten files (data destroyed)
- ‚ùå Secure deletion (wiped inodes)

## üõ°Ô∏è Forensic Best Practices

### 1. Work on Copies

```bash
# ‚ùå NEVER analyze original evidence
python Main.py  # On original disk

# ‚úÖ Always use forensic copies
dd if=/dev/evidence of=evidence.dd bs=4M
python Main.py  # On copy
```

### 2. Hash Verification

```bash
# Before analysis
md5sum evidence.dd > evidence.md5

# After analysis
md5sum -c evidence.md5  # Verify no changes
```

### 3. Document Everything

```bash
# Create case folder
mkdir case_2024_001
cd case_2024_001

# Run analysis
python /path/to/Main.py > analysis.log 2>&1

# Save outputs
cp timeline.csv forensic_report.html case_2024_001/
```

### 4. Chain of Custody

Always log:
- Who acquired the image
- When analysis was performed
- Which tools and versions used
- What findings were discovered

## üêõ Troubleshooting

### Error: "timeline.csv not found"

**Cause:** Analyser.py run before Extractor.py

**Solution:**
```bash
# Run in correct order
python Extractor.py  # First
python Analyser.py   # Second

# Or use Main.py
python Main.py
```

### Error: "Missing column: time"

**Cause:** Corrupted or incompatible timeline.csv

**Solution:**
```bash
# Delete and regenerate
rm timeline.csv
python Extractor.py
```

### Error: "pytsk3 import failed"

**Cause:** TSK libraries not installed

**Solution (Linux):**
```bash
sudo apt-get install libtsk-dev
pip install pytsk3
```

**Solution (Windows):**
```bash
# Download pre-built wheel from:
# https://github.com/py4n6/pytsk/releases
pip install pytsk3-X.X.X-cp3XX-win_amd64.whl
```

### Error: "Permission denied"

**Cause:** Insufficient permissions to read disk image

**Solution (Linux):**
```bash
sudo python Main.py  # Run with elevated privileges
```

### Memory Error on Large Images

**Cause:** Scan limit too high

**Solution:**
```python
# Edit Extractor.py
SCAN_LIMIT = 5000  # Reduce from 10000
```

## üìà Output Interpretation

### HTML Report Sections

1. **Summary**
   - Total events: All timestamp records extracted
   - Total files: Unique files found
   - Suspicious files: Files with detected anomalies

2. **Suspicious Files**
   - Only files that triggered detection rules
   - Lists all flags for each file
   - Prioritize investigation here

3. **Full File Timeline**
   - All files with all timestamp types
   - Useful for timeline reconstruction
   - Context for suspicious files

4. **Raw Timeline Events**
   - Event-by-event view
   - See individual timestamp changes
   - Useful for detailed analysis

## üîê Security Considerations

### Evidence Integrity

- **Read-only access:** Scripts only read disk images
- **No modification:** Original evidence never altered
- **Hash verification:** Always verify before/after

### Privacy

- **Local processing:** All analysis happens locally
- **No network:** Scripts don't send data anywhere
- **Offline capable:** Works without internet

### Legal Compliance

- **Chain of custody:** Document all steps
- **Reproducibility:** Same input = same output
- **Transparency:** Open-source, auditable code

## üìö Additional Resources

### Learning Resources

- [The Sleuth Kit Documentation](http://www.sleuthkit.org/sleuthkit/docs.php)
- [SANS Digital Forensics](https://www.sans.org/cyber-security-courses/advanced-incident-response-threat-hunting-training/)
- [NIST Guide to Integrating Forensic Techniques](https://csrc.nist.gov/publications/detail/sp/800-86/final)

### Related Tools

- **Autopsy** - GUI for The Sleuth Kit
- **FTK Imager** - Disk image acquisition
- **Volatility** - Memory forensics
- **Plaso** - Super Timeline creation

## ü§ù Contributing

Found a bug or want to improve detection rules?

1. Document the issue
2. Test with sample data
3. Propose changes with rationale
4. Consider forensic implications

## ‚öñÔ∏è Legal Notice

This tool is for:
- ‚úÖ Authorized security assessments
- ‚úÖ Incident response investigations
- ‚úÖ Educational purposes
- ‚úÖ Forensic research

**Always ensure proper authorization before analyzing any system.**

## üìÑ License

This forensic analysis system is provided as-is for educational and professional use in digital forensics and incident response.

## üÜò Support

For issues or questions:

1. Check troubleshooting section above
2. Review DOCUMENTATION.md for technical details
3. Verify all dependencies installed correctly
4. Test with small sample image first

---

**Version:** 1.0  
**Last Updated:** 2024  
**Tested On:** Linux (Ubuntu 22.04), Windows 10/11  
**Python:** 3.8+
